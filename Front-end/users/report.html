<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Report User</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-5">
  <div class="container">
    <h2 class="mb-4">Report User</h2>
    <form id="report-form" class="border p-4 rounded shadow-sm bg-light">
      <div class="mb-3">
        <label for="report-reason" class="form-label">Reason</label>
        <select class="form-select" id="report-reason" required>
          <option value="" selected disabled>Select a reason</option>
            <option value="Inappropriate content">Inappropriate content</option>
            <option value="Spam">Spam</option>
            <option value="Fraudulent listing">Fraudulent listing</option>
            <option value="Copyright infringement">Copyright infringement</option>
            <option value="Others">Others</option>

        </select>
      </div>
      <div class="mb-3">
        <label for="report-description" class="form-label">Description</label>
        <textarea
          class="form-control"
          id="report-description"
          rows="4"
          placeholder="Please provide more details about your report..."
        ></textarea>
      </div>
      <button type="submit" class="btn btn-danger">Submit Report</button>
    </form>
    <div id="report-message" class="mt-3"></div>
  </div>
  <script>
    const API_URL = "http://localhost:8000/api"; // change to your API
    const token = localStorage.getItem("auth_token");
    // Get the user ID from URL parameters or a data attribute
    const urlParams = new URLSearchParams(window.location.search);
    const reportedUserId = urlParams.get('userId') || 2; // fallback to 2 for testing
    
    // Check if token exists
    if (!token) {
      document.getElementById("report-message").innerHTML = `
        <div class="alert alert-danger">❌ You must be logged in to submit a report</div>
      `;
    }
    
    document.getElementById("report-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      
      const reason = document.getElementById("report-reason").value;
      const description = document.getElementById("report-description").value;
      

      
      try {
        // FIXED: Changed URL structure to match API route definition
        const res = await fetch(`${API_URL}/users/report/${reportedUserId}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`,
            "Accept": "application/json"
          },
          body: JSON.stringify({ 
            reason, 
            description 
          })
        });

        console.log("Token", token);
        
        // Get more detailed error information
        const data = await res.json().catch(() => ({}));
        
        if (!res.ok) {
          console.error("Server response:", data);
          throw new Error(data.error || data.message || `Failed to submit report (Status: ${res.status})`);
        }
        
        document.getElementById("report-message").innerHTML = `
          <div class="alert alert-success">✅ Report submitted successfully!</div>
        `;
        
        e.target.reset();
      } catch (error) {
        console.error("Report submission error:", error);
        document.getElementById("report-message").innerHTML = `
          <div class="alert alert-danger">❌ ${error.message}</div>
        `;
      }
    });
  </script>
</body>
</html>